# HW5 &ndash; Errors, Defer, I/O

---

## Анализ оценок студентов

### Дан следующий фрагмент кода

`internal/mark/mark.go`

```golang
package mark

import (
  "io"
)

type Student struct {
  Name string
  Mark int
}

type StudentsStatistic interface {
  SummaryByStudent(student string) (int, bool)     // default_value, false - если студента нет
  AverageByStudent(student string) (float32, bool) // default_value, false - если студента нет
  Students() []string
  Summary() int
  Median() int
  MostFrequent() int
}

func ReadStudentsStatistic(reader io.Reader) (StudentsStatistic, error) {
  return nil, nil
}

func WriteStudentsStatistic(writer io.Writer, statistic StudentsStatistic) error {
  return nil
}
```

Запрещается в приведённом фрагменте кода:

* Менять сигнатуры;
* Менять модификаторы доступа;

### Задание

На вход программе подаётся путь к файлу формата `tsv`, строки файла содержат студента и его балл:
* пример строки &ndash; `Примеров Пример Примерович\t5`; 
* `\t` в данном примере &ndash; табуляция ;
* **студент** &ndash; любая последовательность символов (кроме служебных и управляющих, таких как `\n\r\t`);
* **оценка** &ndash; целое число от 1 до 10. 

Считается, что файл содержит корректные имена и оценки; требуется игнорировать строки, не подходящие под заданный формат
(пример нарушения формата &ndash; `Примеров Пример Примерович5\t`).

**Hint**: данные можно считать статичными, в том смысле, что не понадобится реализовывать изменение данных после чтения.

**Требуется посчитать**:

- Сумму баллов по студенту (считать, что полных тёзок нет);
- Средний балл по студенту (с точностью 2 знака после запятой);
- Отсортированный список студентов по убыванию суммы баллов;
- Сумму всех баллов;
- Медиану по выставленным баллам (при подсчёте индекса используем округление вверх);
- Самый часто выставленный балл (если несколько &ndash; берём наибольший);

#### Тесты

* Напишите тесты, покрывающие функциональность.
* Свои тесты разместите в `mark_test.go`

#### I/O:

* `ReadStudentsStatistic` для чтения `tsv`;
* `WriteStudentsStatistic` для записи `tsv`;

Если программа завершилась успешно, в файле `file_name` содержится вывод, иначе программа должна вернуть ошибку.

**Формат вывода**:

* Первая строка содержит 3 числа, записанных через разделитель `\t`, в порядке:
  - Сумма всех баллов;
  - Медиана по выставленным баллам;
  - Самый часто выставленный балл;
* Начиная со второй строки, выводится список студентов в порядке убывания суммы баллов, каждая строка содержит данные, 
записанные через разделитель `\t`, в порядке:
  - Студент;
  - Сумма баллов по студенту;
  - Средний балл по студенту;

#### Пример

* [Пример файла с оценками](./data/input_1.tsv)
* [Пример файла, содержащий вывод](./data/output_1.tsv)

---

## Игры с `defer`

Это **бонусное задание**. Если его не выполнять, то ваши баллы
за ДЗ не уменьшатся. Но если сделаете &ndash; получите дополнительные 
баллы в колонку "Практика".

### Дан следующий фрагмент кода

`internal/defer/wut.go`

```golang
package _defer

import (
	"fmt"
	"io"
)

type Counter struct {
  writer io.Writer
  value int
}

func (c *Counter) Increment() {
  c.value++
}

func (c *Counter) Printer() func() {
  value := c.value
  printer := func() {
    _, _ = fmt.Fprint(c.writer, value)
  }
  return printer
}

func PrintSequence(writer io.Writer) {
  counter := Counter{writer, 0}
  ...
}
```

Замените многоточие на код, состоящий только из
* `defer`,
* объявлений и вызовов новых анонимных функций без аргументов и return value,
* вызовов методов `counter`,

чтобы вызов `PrintSequence()` выводил на экран
1. `135642`
2. `1345287960`

Иными словами, запрещены любые арифметические и логические операции, ключевые слова, кроме `defer` и `func`,
создание новых переменных, и запрещено трогать поле `Counter::value` или создавать функции с аргументами.

#### Тесты

Напишите тест ко второй части задания и добавьте его в пайплайн. Для этого можете использовать строковый буфер и 
`Writer`, который в него пишет &ndash; после вызова функции вы сможете получить из него вывод как строку.

---

## Как сдавать:

* Проверить, что появился **ваш личный** репозиторий с `HW5`, сделать его клон,
личный репозиторий имеет вид `https://tinkoff-edu.gitlab.yandexcloud.net/itmo-course-autumn-2023/Students/<username>/Homeworks/HW5`
* Добавить ваше решение в ветку `hw`
* Добавить файл конфигурации `.gitlab-ci.yml` для запуска пайплайна с тестами
* Открыть _Merge request_ из ветки `hw` в ветку `master` **вашего репозитория** (не основного)
* Дождаться, когда пайплайн станет зелёным
* Если будут вопросы по времени сдачи дз &ndash; мы будем ориентироваться на время последнего вашего действия в _Merge request_.